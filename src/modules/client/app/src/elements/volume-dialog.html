<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/core/app-theme.html">
<link rel="import" href="/core/app-icons.html">

<link rel="import" href="/core/elements/app-dialog.html">

<link rel="import" href="/core/services/os-controller.html">

<link rel="import" href="/core/behaviors/socket-behavior.html">

<dom-module id="volume-dialog">
  <template>
    <style include="app-theme"></style>

    <os-controller id="osController"></os-controller>

    <app-dialog opened="{{opened}}" with-backdrop always-on-top>
      <app-toolbar>
        <paper-icon-button icon="app-icons:close" dialog-dismiss></paper-icon-button>
        <paper-slider id="mainSlider" value="{{volume}}" pin></paper-slider>
      </app-toolbar>
      <volume-touch-slider value="{{volume}}"></volume-touch-slider>
    </app-dialog>
  </template>
  <script>
    Polymer({
      is: 'volume-dialog',

      behaviors: [
        TuxRemote.SocketBehavior
      ],

      properties: {
        volume: {
          type: Number,
          value: 0,
          notify: true,
        },

        opened: {
          type: Boolean,
          value: false,
          notify: true,
        }
      },

      listeners: {
        'osController.volume-changed': '_onVolumeChanged',
        'mainSlider.immediate-value-change': '_onMainSliderChange',
        'mainSlider.change': '_onMainSliderChange',
      },

      attached: function() {
        this.socketEmit('tuxRemote/osController/getSound');
      },

      _onVolumeChanged: function(event, level) {
        this.set('volume', level);
      },

      _onMainSliderChange: function() {
        this.socketEmit('tuxRemote/osController/setSound', this.$.mainSlider.immediateValue);
      },
    });
  </script>
</dom-module>
